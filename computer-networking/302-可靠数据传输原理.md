# 可靠数据传输原理

1. 可靠数据传输服务的作用是：为上层服务模拟出一条可靠信道（即使下层实际通道是不可信的，比如IP协议下的链路通道）。借助可靠信道，传输数据比特不会受到损坏或者丢失，而且所有数据都是按照其发送顺序进行交付。这就是TCP为应用层提供的服务。提供这种服务是可靠数据传输协议的责任。

2. 有限状态机（Finite-State Machine，FSM），也叫有限自动状态机，简称状态机，是表示有限个状态以及在这些状态之间的转移和动作等行为的数学模型。

3. 构建可靠数据传输协议的几种假设信道下的推导：

  a. 完全可靠信道：不用协议做什么工作，协议只管封装发送数据，接受解析数据。
  b. 具有比特差错（数据可能出错，但是不会丢包，包顺序不会变）信道：需要三种协议功能：差错检测、接收方反馈（NAK，ACK）、重传。如果出现错误时，接收方返回NAK，发送方进行重传。考虑到ACK包和NAK包也会出错，还需要添加一种协议来处理这种情况。通常的做法是重传，但是这样会引入冗余分组（接收方不知道这是一次新的分组还是重传的分组），所以需要为分组添加序号来区分。
  当有分组序号的时候，接收方就可以通过对上一次正确接受的分组发送一个ACK来代替NAK。

  c. 具有比特差错的丢包信道：需要在前面的协议基础上加上重传机制，当回执超时时，发送方进行重传。这样也会引入冗余分组。

4. 几种典型的传输协议（不一定是实际中会用到的）：

  - 停等（stop-and-wait）协议：每发一条消息，都需要等到接收方的成功回执才发送下一条消息。相当于串行执行，效率很低。对应的是流水线传输协议。
  - 比特交替协议（alternating-bit protocol），分组号在0和1之间交替。它也是一种停等协议，不然分组号只有0和1无法满足要求。
  - 流水线可靠传输协议。可以连续发送多个分组而不用等待前面分组的回执。

5. 流水线技术对可靠数据传输的影响如下：

  a. 必须增加序号范围，每个分组（不算重传）必须有一个唯一的标识，可能会有多个未确认的分组。
  b. 协议的发送方和接收方必须缓存多个分组，因为可能会有多个未确认的分组。
  c. 所需序号范围和对缓存的要求取决于数据传输协议如何处理丢失，损坏以及延时过大的分组。解决流水线的差错恢复有两种基本方法是：回退N步（Go-Back-N，GBN） 和选择重传（Selective，SR）。两种方法都会重传，只是重传的分组不同。

6. GBN协议又被称为滑动窗口协议（sliding-window protocol）。
